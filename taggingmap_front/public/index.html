<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>태깅맵</title>
    <!-- index.html의 </head> 태그 바로 앞에 추가하세요 -->
    <script>
      // Google API 초기화를 위한 전역 변수
      window.googleAuthInitialized = false;
      window.googleAuthInstance = null;
      
      function handleClientLoad() {
        console.log('Google API 클라이언트 로드됨');
        gapi.load('client:auth2', initAuth);
      }
      
      function initAuth() {
        if (window.googleAuthInitialized) {
          console.log('Google 인증이 이미 초기화됨, 재사용');
          return;
        }
        
        console.log('Google Auth2 초기화 시작');
        try {
          gapi.client.init({
            apiKey: 'API_KEY', // (선택사항) Google API 키
            clientId: '434460786285-svua7r71njstq0rdqmuacth5tlq6d49d.apps.googleusercontent.com',
            scope: 'email profile'
          }).then(function() {
            window.googleAuthInstance = gapi.auth2.getAuthInstance();
            window.googleAuthInitialized = true;
            console.log('Google 인증 초기화 성공');
            
            // 인증 상태 변경 리스너
            window.googleAuthInstance.isSignedIn.listen(updateSigninStatus);
            
            // 이벤트 발생
            window.dispatchEvent(new CustomEvent('google-auth-initialized', {
              detail: { success: true }
            }));
          }).catch(function(error) {
            console.error('Google 인증 초기화 오류:', error);
            window.dispatchEvent(new CustomEvent('google-auth-initialized', {
              detail: { success: false, error: error }
            }));
          });
        } catch (e) {
          console.error('Google 인증 초기화 예외:', e);
          window.dispatchEvent(new CustomEvent('google-auth-initialized', {
            detail: { success: false, error: e }
          }));
        }
      }
      
      function updateSigninStatus(isSignedIn) {
        console.log('Google 로그인 상태 변경:', isSignedIn);
      }
      
      // 외부에서 접근할 함수들
      window.getGoogleAuthInstance = function() {
        return window.googleAuthInstance;
      };
    </script>

    <!-- Google API 로드 -->
    <script src="https://apis.google.com/js/api.js?onload=handleClientLoad" async defer></script>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but 태깅맵 doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>